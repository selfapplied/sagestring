<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diatom Computing: Computation Through Biological Growth</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #00ff88;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #00ff88;
            padding-bottom: 20px;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(45deg, #00ff88, #00aaff, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .theorem {
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid #00ff88;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .theorem h3 {
            color: #00aaff;
            margin-bottom: 10px;
        }

        .theorem .formula {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 5px;
            font-size: 1.1rem;
            color: #00ff88;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .panel {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid #00ff88;
            border-radius: 10px;
            padding: 20px;
        }

        .panel h2 {
            color: #00aaff;
            margin-bottom: 15px;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }

        canvas {
            width: 100%;
            height: 400px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
            border-radius: 5px;
            margin: 10px 0;
        }

        .controls {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid #00ff88;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        button {
            background: #00ff88;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
        }

        button:hover {
            background: #00aaff;
            transform: scale(1.05);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            border-radius: 5px;
            padding: 15px;
            text-align: center;
        }

        .stat-card .label {
            color: #00aaff;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .stat-card .value {
            color: #00ff88;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .ce1-expression {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #00ff88;
            margin: 10px 0;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåä Diatom Computing</h1>
            <p style="font-size: 1.2rem; opacity: 0.8;">Computation Through Biological Growth</p>
        </div>

        <div class="theorem">
            <h3>üìê Fixed-Point Theorem</h3>
            <div class="formula">&lt; {D} + [L] + (M) + F &gt;</div>
            <p>Has a unique fixed point if (M) is a contraction mapping.</p>
            <p style="margin-top: 10px; font-size: 0.9rem; opacity: 0.8;">
                {D} = domain (boundary) | [L] = lattice (structure) | (M) = morphism (growth) | F = frustule (result)
            </p>
        </div>

        <div class="theorem">
            <h3>üîÑ Colony Synchronization Theorem</h3>
            <div class="formula">N diatoms achieve consensus in O(‚àöN) steps</div>
            <p>Under adiabatic environmental changes, by law of large numbers.</p>
        </div>

        <div class="main-grid">
            <div class="panel">
                <h2>üî¨ Single Diatom Growth</h2>
                <canvas id="diatomCanvas"></canvas>
                <div class="ce1-expression" id="ce1Expression"></div>
            </div>

            <div class="panel">
                <h2>üåä Colony Formation</h2>
                <canvas id="colonyCanvas"></canvas>
                <div id="colonyStats"></div>
            </div>
        </div>

        <div class="panel">
            <h2>‚ö° Optical Network</h2>
            <canvas id="networkCanvas"></canvas>
        </div>

        <div class="controls">
            <button onclick="growDiatom()">üå± Grow Diatom</button>
            <button onclick="growColony()">üåä Grow Colony</button>
            <button onclick="computeFixedPoint()">üéØ Compute Fixed Point</button>
            <button onclick="createNetwork()">üîó Create Optical Network</button>
            <button onclick="reset()">üîÑ Reset</button>
        </div>

        <div class="stats" id="stats"></div>
    </div>

    <script>
        // Diatom Frustule
        class DiatomFrustule {
            constructor(radius = 10, symmetry = 'radial') {
                this.radius = radius;
                this.symmetry = symmetry;
                this.generation = 0;
                this.nodes = this.generateNodes();
                this.growthRate = 0.1;
                this.contractionFactor = 0.95;
            }

            generateNodes() {
                const nodes = [];
                const numNodes = 12;
                for (let i = 0; i < numNodes; i++) {
                    const angle = (2 * Math.PI * i) / numNodes;
                    nodes.push({
                        x: this.radius * Math.cos(angle),
                        y: this.radius * Math.sin(angle),
                        angle,
                        silica: 1.0
                    });
                }
                return nodes;
            }

            grow() {
                this.generation++;
                const growthFactor = 1 + this.growthRate;
                const contractionFactor = this.contractionFactor;
                
                this.radius *= growthFactor * contractionFactor;
                this.nodes = this.nodes.map(node => ({
                    ...node,
                    x: node.x * growthFactor * contractionFactor,
                    y: node.y * growthFactor * contractionFactor,
                    silica: Math.min(1.0, node.silica * growthFactor)
                }));
                
                return this;
            }

            toCE1() {
                return `<{radius:${this.radius.toFixed(2)},symmetry:${this.symmetry}}+[nodes:${this.nodes.length}]+(growth:${this.growthRate})+F>`;
            }
        }

        // Diatom Colony
        class DiatomColony {
            constructor(size = 10) {
                this.diatoms = [];
                this.size = size;
                this.consensusSteps = 0;
                
                for (let i = 0; i < size; i++) {
                    this.diatoms.push(new DiatomFrustule(
                        10 + Math.random() * 5,
                        Math.random() > 0.5 ? 'radial' : 'bilateral'
                    ));
                }
            }

            grow() {
                this.diatoms.forEach(d => d.grow());
                this.consensusSteps++;
            }

            checkConsensus() {
                const radii = this.diatoms.map(d => d.radius);
                const mean = radii.reduce((a, b) => a + b, 0) / radii.length;
                const variance = radii.reduce((sum, r) => sum + Math.pow(r - mean, 2), 0) / radii.length;
                return Math.sqrt(variance) / mean < 0.1;
            }

            expectedConsensusSteps() {
                return Math.ceil(Math.sqrt(this.size));
            }
        }

        // State
        let diatom = new DiatomFrustule();
        let colony = new DiatomColony(20);
        let network = null;

        // Canvas setup
        function setupCanvas(id) {
            const canvas = document.getElementById(id);
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth;
            canvas.height = 400;
            return { canvas, ctx };
        }

        // Draw diatom
        function drawDiatom() {
            const { canvas, ctx } = setupCanvas('diatomCanvas');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const scale = 5;
            
            // Draw frustule
            ctx.strokeStyle = '#00ff88';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            diatom.nodes.forEach((node, i) => {
                const x = centerX + node.x * scale;
                const y = centerY + node.y * scale;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.closePath();
            ctx.stroke();
            
            // Draw nodes (pores)
            ctx.fillStyle = '#00aaff';
            diatom.nodes.forEach(node => {
                const x = centerX + node.x * scale;
                const y = centerY + node.y * scale;
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, Math.PI * 2);
                ctx.fill();
            });
            
            // Draw center
            ctx.fillStyle = '#ff6b6b';
            ctx.beginPath();
            ctx.arc(centerX, centerY, 5, 0, Math.PI * 2);
            ctx.fill();
            
            // Update CE1 expression
            document.getElementById('ce1Expression').textContent = diatom.toCE1();
        }

        // Draw colony
        function drawColony() {
            const { canvas, ctx } = setupCanvas('colonyCanvas');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const scale = 3;
            const spacing = 40;
            
            // Arrange diatoms in grid
            const cols = Math.ceil(Math.sqrt(colony.size));
            const rows = Math.ceil(colony.size / cols);
            
            colony.diatoms.forEach((d, i) => {
                const col = i % cols;
                const row = Math.floor(i / cols);
                const centerX = (col + 1) * spacing;
                const centerY = (row + 1) * spacing;
                
                // Draw frustule
                ctx.strokeStyle = colony.checkConsensus() ? '#00ff88' : '#00aaff';
                ctx.lineWidth = 1;
                ctx.beginPath();
                
                d.nodes.forEach((node, j) => {
                    const x = centerX + node.x * scale;
                    const y = centerY + node.y * scale;
                    if (j === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                ctx.closePath();
                ctx.stroke();
            });
            
            // Update stats
            const statsDiv = document.getElementById('colonyStats');
            statsDiv.innerHTML = `
                <div style="margin-top: 10px; color: #00aaff;">
                    <div>Size: ${colony.size}</div>
                    <div>Steps: ${colony.consensusSteps}</div>
                    <div>Expected: ${colony.expectedConsensusSteps()}</div>
                    <div>Consensus: ${colony.checkConsensus() ? '‚úì' : '...'}</div>
                </div>
            `;
        }

        // Draw network
        function drawNetwork() {
            const { canvas, ctx } = setupCanvas('networkCanvas');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (!network) return;
            
            // Draw edges
            ctx.strokeStyle = '#00aaff';
            ctx.lineWidth = 1;
            network.edges.forEach(edge => {
                const from = network.nodes[edge.from];
                const to = network.nodes[edge.to];
                ctx.beginPath();
                ctx.moveTo(from.x, from.y);
                ctx.lineTo(to.x, to.y);
                ctx.stroke();
            });
            
            // Draw nodes
            ctx.fillStyle = '#00ff88';
            network.nodes.forEach(node => {
                ctx.beginPath();
                ctx.arc(node.x, node.y, 5, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // Update stats
        function updateStats() {
            const statsDiv = document.getElementById('stats');
            statsDiv.innerHTML = `
                <div class="stat-card">
                    <div class="label">Generation</div>
                    <div class="value">${diatom.generation}</div>
                </div>
                <div class="stat-card">
                    <div class="label">Radius</div>
                    <div class="value">${diatom.radius.toFixed(2)}</div>
                </div>
                <div class="stat-card">
                    <div class="label">Colony Size</div>
                    <div class="value">${colony.size}</div>
                </div>
                <div class="stat-card">
                    <div class="label">Consensus Steps</div>
                    <div class="value">${colony.consensusSteps}</div>
                </div>
            `;
        }

        // Control functions
        window.growDiatom = function() {
            diatom.grow();
            drawDiatom();
            updateStats();
        };

        window.growColony = function() {
            colony.grow();
            drawColony();
            updateStats();
        };

        window.computeFixedPoint = function() {
            // Run until convergence
            let iterations = 0;
            const maxIter = 100;
            const initialRadius = diatom.radius;
            
            while (iterations < maxIter) {
                const before = diatom.radius;
                diatom.grow();
                const after = diatom.radius;
                
                if (Math.abs(after - before) < 0.001) {
                    alert(`üéØ Fixed Point Found!\n\nIterations: ${iterations}\nRadius: ${diatom.radius.toFixed(2)}\nConverged: ‚úì`);
                    break;
                }
                iterations++;
            }
            
            drawDiatom();
            updateStats();
        };

        window.createNetwork = function() {
            // Create optical network
            const nodes = colony.diatoms.map((d, i) => {
                const col = i % Math.ceil(Math.sqrt(colony.size));
                const row = Math.floor(i / Math.ceil(Math.sqrt(colony.size)));
                return {
                    x: 50 + col * 60,
                    y: 50 + row * 60,
                    diatom: d
                };
            });
            
            const edges = [];
            for (let i = 0; i < nodes.length; i++) {
                for (let j = i + 1; j < nodes.length; j++) {
                    const dx = nodes[i].x - nodes[j].x;
                    const dy = nodes[i].y - nodes[j].y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < 80) {
                        edges.push({ from: i, to: j });
                    }
                }
            }
            
            network = { nodes, edges };
            drawNetwork();
        };

        window.reset = function() {
            diatom = new DiatomFrustule();
            colony = new DiatomColony(20);
            network = null;
            drawDiatom();
            drawColony();
            drawNetwork();
            updateStats();
        };

        // Initialize
        drawDiatom();
        drawColony();
        updateStats();
    </script>
</body>
</html>

